<!-- Navbar -->
<nav class="main-header navbar navbar-expand-md navbar-light navbar-white">
  <div class="container">
    <a href="/user" class="navbar-brand">
      <span class="brand-text font-weight-light">Faceelook</span>
    </a>

    <div class="collapse navbar-collapse order-3">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="/logout">
            <i class="fas fa-sign-out-alt"></i> Logout
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="content-wrapper">
  <div class="content pt-4">
    <div class="container">

      <% if (!profile) { %>
        <div class="alert alert-warning text-center">
          Profil Anda belum dibuat.
          <br />
          <a href="/user/settings" class="btn btn-sm btn-primary mt-2">
            Lengkapi Profil Sekarang
          </a>
        </div>
        <% } %>

          <div class="row">

            <!-- LEFT SIDE -->
            <div class="col-md-3">

              <!-- Profile Card -->
              <div class="card card-primary card-outline">
                <div class="card-body box-profile">

                  <div class="text-center">
                    <img class="profile-user-img img-fluid img-circle"
                      src="<%= profile?.photo_url || 'https://cdn-icons-png.flaticon.com/512/149/149071.png' %>"
                      alt="User profile picture" />
                  </div>

                  <h3 class="profile-username text-center">
                    <%= profile?.full_name || 'Nama belum diatur' %>
                  </h3>

                  <p class="text-muted text-center">
                    <%= profile?.bio || 'Belum menambahkan bio' %>
                  </p>

                  <button class="btn btn-primary btn-block" data-toggle="modal" data-target="#editProfileModal">
                    <b>Edit Profile</b>
                  </button>

                </div>
              </div>

              <!-- About Me -->
              <div class="card card-primary">
                <div class="card-header">
                  <h3 class="card-title">About Me</h3>
                </div>

                <div class="card-body">

                  <strong>
                    <i class="fas fa-book mr-1"></i> Education
                  </strong>
                  <p class="text-muted">
                    <%= profile?.education || 'Belum mengisi riwayat pendidikan' %>
                  </p>

                  <hr />

                  <strong>
                    <i class="fas fa-map-marker-alt mr-1"></i> Location
                  </strong>
                  <p class="text-muted">
                    <%= profile?.address || 'Lokasi belum diatur' %>
                  </p>

                  <hr />

                  <strong>
                    <i class="fas fa-pencil-alt mr-1"></i> Skills
                  </strong>
                  <p class="text-muted">
                    <%= profile?.skills || 'Belum menambahkan keahlian' %>
                  </p>

                  <hr />

                  <strong>
                    <i class="fas fa-venus-mars mr-1"></i> Gender
                  </strong>
                  <p class="text-muted">
                    <%= profile?.gender || 'Belum diisi' %>
                  </p>

                  <hr />

                  <strong>
                    <i class="fas fa-birthday-cake mr-1"></i> Date of Birth
                  </strong>
                  <p class="text-muted">
                    <%= profile?.date_of_birth || 'Belum diisi' %>
                  </p>

                </div>
              </div>
            </div>

            <!-- RIGHT SIDE -->
            <div class="col-md-9">
              <div class="card">
                <div class="card-header p-2">
                  <ul class="nav nav-pills">
                    <li class="nav-item">
                      <a class="nav-link active" href="#activity" data-toggle="tab">
                        Aktivitas & Social Feed
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="#posts" data-toggle="tab">
                        Postingan Saya
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="#settings" data-toggle="tab">
                        Settings
                      </a>
                    </li>
                  </ul>
                </div>

                <div class="card-body">
                  <div class="tab-content">

                    <!-- Activity -->
                    <div class="active tab-pane" id="activity">


                      <% if (otherPost && otherPost.length> 0) { %>

                        <% otherPost.forEach(post=> { %>

                          <div class="card card-widget mb-3">

                            <!-- HEADER -->
                            <div class="card-header">
                              <div class="user-block">
                                <img class="img-circle"
                                  src="<%= post.user.profile?.photo_url || 'https://cdn-icons-png.flaticon.com/512/149/149071.png' %>"
                                  alt="User Image">

                                <span class="username">
                                  <a href="#">
                                    <%= post.user?.profile?.full_name || 'No Name' %>
                                  </a>
                                </span>

                                <span class="description time-ago" data-time="<%= post.created_at %>">
                                </span>
                              </div>
                            </div>

                            <!-- BODY -->
                            <div class="card-body">

                              <% if (post.paragraph) { %>
                                <p>
                                  <%= post.paragraph %>
                                </p>
                                <% } %>

                                  <% if (post.images && post.images.length> 0) { %>

                                    <% if (post.images.length> 4) { %>

                                      <!-- CAROUSEL -->
                                      <div id="carousel-<%= post.id %>" class="carousel slide mb-3"
                                        data-ride="carousel">

                                        <div class="carousel-inner">
                                          <% post.images.forEach((image, index)=> { %>
                                            <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
                                              <img class="d-block w-100 preview-image"
                                                style="max-height:500px; object-fit:cover;" src="<%= image.url %>">
                                            </div>
                                            <% }) %>
                                        </div>

                                        <a class="carousel-control-prev" href="#carousel-<%= post.id %>"
                                          data-slide="prev">
                                          <span class="carousel-control-prev-icon"></span>
                                        </a>

                                        <a class="carousel-control-next" href="#carousel-<%= post.id %>"
                                          data-slide="next">
                                          <span class="carousel-control-next-icon"></span>
                                        </a>

                                      </div>

                                      <% } else if (post.images.length===1) { %>

                                        <!-- SINGLE IMAGE -->
                                        <img class="img-fluid rounded mb-2 preview-image"
                                          src="<%= post.images[0].url %>">

                                        <% } else { %>

                                          <!-- GRID 2-4 IMAGE -->
                                          <div class="row">
                                            <% post.images.forEach(image=> { %>
                                              <div class="col-6 col-md-4 mb-2">
                                                <img class="img-fluid rounded preview-image"
                                                  style="height:200px; object-fit:cover; width:100%;"
                                                  src="<%= image.url %>">
                                              </div>
                                              <% }) %>
                                          </div>

                                          <% } %>

                                            <% } %>

                                              <hr>

                                              <div class="d-flex justify-content-between align-items-center">

                                                <!-- LEFT SIDE -->
                                                <div>
                                                  <button class="btn btn-default btn-sm">
                                                    <i class="far fa-thumbs-up"></i> Like
                                                  </button>

                                                  <button class="btn btn-default btn-sm">
                                                    <i class="far fa-comment"></i> Comment
                                                  </button>
                                                </div>

                                                <!-- RIGHT SIDE -->
                                                <div>
                                                  <form method="POST"
                                                    onsubmit="return confirm('Yakin ingin menghapus postingan ini?')">

                                                    <button class="btn btn-default btn-sm">
                                                      <i class="fas fa-share"></i> Share
                                                    </button>

                                                  </form>
                                                </div>

                                              </div>
                            </div>
                          </div>

                          <% }) %>

                            <% } else { %>

                              <div class="alert alert-info">
                                Medsos belum memiliki aktivitas sama sekali.
                              </div <% } %>





                    </div>

                    <!-- Post -->
                    <div class="tab-pane" id="posts">


                      <div class="d-flex align-items-center mb-3">

                        <!-- Avatar -->
                        <img src="<%= profile?.photo_url || 'https://cdn-icons-png.flaticon.com/512/149/149071.png' %>"
                          class="img-circle" width="40" height="40" />

                        <!-- Input -->
                        <input type="text" class="form-control ml-2" placeholder="Apa yang Anda pikirkan hari ini?" />

                        <!-- Add Button -->
                        <button class="btn btn-primary ml-2" type="button">
                          <i class="fas fa-plus"></i>
                        </button>

                      </div>


                      <% if (myPost && myPost.length> 0) { %>

                        <% myPost.forEach(post=> { %>

                          <div class="card card-widget mb-3">

                            <!-- HEADER -->
                            <div class="card-header">
                              <div class="user-block">
                                <img class="img-circle"
                                  src="<%= post.user.profile?.photo_url || 'https://cdn-icons-png.flaticon.com/512/149/149071.png' %>"
                                  alt="User Image">

                                <span class="username">
                                  <a href="#">
                                    <%= post.user?.profile?.full_name || 'No Name' %>
                                  </a>
                                </span>

                                <span class="description time-ago" data-time="<%= post.created_at %>">
                                </span>
                              </div>
                            </div>

                            <!-- BODY -->
                            <div class="card-body">

                              <% if (post.paragraph) { %>
                                <p>
                                  <%= post.paragraph %>
                                </p>
                                <% } %>

                                  <% if (post.images && post.images.length> 0) { %>

                                    <% if (post.images.length> 4) { %>

                                      <!-- CAROUSEL -->
                                      <div id="carousel-<%= post.id %>" class="carousel slide mb-3"
                                        data-ride="carousel">

                                        <div class="carousel-inner">
                                          <% post.images.forEach((image, index)=> { %>
                                            <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
                                              <img class="d-block w-100 preview-image"
                                                style="max-height:500px; object-fit:cover;" src="<%= image.url %>">
                                            </div>
                                            <% }) %>
                                        </div>

                                        <a class="carousel-control-prev" href="#carousel-<%= post.id %>"
                                          data-slide="prev">
                                          <span class="carousel-control-prev-icon"></span>
                                        </a>

                                        <a class="carousel-control-next" href="#carousel-<%= post.id %>"
                                          data-slide="next">
                                          <span class="carousel-control-next-icon"></span>
                                        </a>

                                      </div>

                                      <% } else if (post.images.length===1) { %>

                                        <!-- SINGLE IMAGE -->
                                        <img class="img-fluid rounded mb-2 preview-image"
                                          src="<%= post.images[0].url %>">

                                        <% } else { %>

                                          <!-- GRID 2-4 IMAGE -->
                                          <div class="row">
                                            <% post.images.forEach(image=> { %>
                                              <div class="col-6 col-md-4 mb-2">
                                                <img class="img-fluid rounded preview-image"
                                                  style="height:200px; object-fit:cover; width:100%;"
                                                  src="<%= image.url %>">
                                              </div>
                                              <% }) %>
                                          </div>

                                          <% } %>

                                            <% } %>

                                              <hr>

                                              <div class="d-flex justify-content-between align-items-center">

                                                <!-- LEFT SIDE -->
                                                <div>
                                                  <button class="btn btn-default btn-sm">
                                                    <i class="far fa-thumbs-up"></i> Like
                                                  </button>

                                                  <button class="btn btn-default btn-sm">
                                                    <i class="far fa-comment"></i> Comment
                                                  </button>
                                                </div>

                                                <!-- RIGHT SIDE -->
                                                <div>
                                                  <form action="/web-user/delete-post/<%= post.id %>" method="POST"
                                                    onsubmit="return confirm('Yakin ingin menghapus postingan ini?')">

                                                    <button class="btn btn-danger btn-sm">
                                                      <i class="fas fa-trash"></i> Hapus
                                                    </button>

                                                  </form>
                                                </div>

                                              </div>

                            </div>
                          </div>

                          <% }) %>

                            <% } else { %>

                              <div class="text-muted text-center">
                                Belum ada postingan.
                              </div>

                              <% } %>



                    </div>


                    <!-- Settings -->
                    <div class="tab-pane" id="settings">
                      <div class="text-center">
                        <p>Kelola akun dan informasi pribadi Anda.</p>
                        <a class="btn btn-primary">
                          Buka Pengaturan
                        </a>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>

          </div>
    </div>
  </div>
</div>

<!-- Footer -->
<footer class="main-footer">
  <div class="container">
    <div class="float-right d-none d-sm-block">
      <b>Version</b> 1.0.0
    </div>
    <strong>
      &copy; <%= new Date().getFullYear() %> from Faceelook
    </strong>
    All rights reserved.
  </div>
</footer>

<!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Edit Profile</h5>
        <button type="button" class="close" data-dismiss="modal">
          <span>&times;</span>
        </button>
      </div>

      <form method="POST" action="/web-user/update/profile" enctype="multipart/form-data">

        <div class="modal-body" style="max-height:70vh; overflow-y:auto;">

          <!-- PROFILE PHOTO -->
          <div class="text-center mb-4">
            <div class="position-relative d-inline-block">

              <img id="profilePreview"
                src="<%= profile?.photo_url || 'https://cdn-icons-png.flaticon.com/512/149/149071.png' %>"
                class="rounded-circle shadow" width="120" height="120" style="object-fit:cover;" />

              <label class="btn btn-sm btn-primary position-absolute"
                style="bottom:0; right:0; border-radius:50%; padding:6px 8px;">
                üñãÔ∏è
                <input type="file" name="photo" id="photoInput" hidden accept="image/*" />
              </label>

            </div>
            <div class="mt-2 text-muted small">
              Klik icon untuk ganti foto
            </div>
          </div>

          <div class="row">

            <!-- Full Name -->
            <div class="col-md-6">
              <div class="form-group">
                <label>Full Name</label>
                <input type="text" name="full_name" class="form-control" value="<%= profile?.full_name || '' %>"
                  placeholder="Masukkan nama lengkap" />
              </div>
            </div>

            <!-- Gender -->
            <div class="col-md-6">
              <div class="form-group">
                <label>Gender</label>
                <select name="gender" class="form-control">
                  <option value="">Pilih Gender</option>
                  <option value="MALE" <%=profile?.gender==='MALE' ? 'selected' : '' %>>Male</option>
                  <option value="FEMALE" <%=profile?.gender==='FEMALE' ? 'selected' : '' %>>Female</option>
                </select>
              </div>
            </div>

            <!-- Bio -->
            <div class="col-12">
              <div class="form-group">
                <label>Bio</label>
                <textarea name="bio" class="form-control" rows="2"
                  placeholder="Ceritakan tentang diri Anda"><%= profile?.bio || '' %></textarea>
              </div>
            </div>

            <!-- Education -->
            <div class="col-md-6">
              <div class="form-group">
                <label>Education</label>
                <input type="text" name="education" class="form-control" value="<%= profile?.education || '' %>"
                  placeholder="Contoh: S1 Informatika" />
              </div>
            </div>

            <!-- Date of Birth -->
            <div class="col-md-6">
              <div class="form-group">
                <label>Date of Birth</label>
                <input type="date" name="date_of_birth" class="form-control"
                  value="<%= profile?.date_of_birth || '' %>" />
              </div>
            </div>

            <!-- Address -->
            <div class="col-12">
              <div class="form-group">
                <label>Address</label>
                <input type="text" name="address" class="form-control" value="<%= profile?.address || '' %>"
                  placeholder="Masukkan alamat" />
              </div>
            </div>

            <!-- Skills -->
            <div class="col-12">
              <div class="form-group">
                <label>Skills</label>
                <input type="text" name="skills" class="form-control" value="<%= profile?.skills || '' %>"
                  placeholder="Pisahkan dengan koma" />
              </div>
            </div>

          </div>
        </div>

        <!-- FOOTER FIXED -->
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">
            Cancel
          </button>

          <button type="submit" class="btn btn-primary">
            Save Changes
          </button>
        </div>

      </form>

    </div>
  </div>
</div>

<!-- Light box post preview modal -->
<div class="modal fade" id="lightboxModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content bg-dark">
      <div class="modal-body text-center p-0">
        <img id="lightboxImage" class="img-fluid">
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("click", function (e) {
    if (e.target.classList.contains("preview-image")) {
      document.getElementById("lightboxImage").src = e.target.src;
      $('#lightboxModal').modal('show');
    }
  });


  document.getElementById('photoInput').addEventListener('change', function (e) {
    const file = e.target.files[0];
    if (file) {
      document.getElementById('profilePreview').src = URL.createObjectURL(file);
    }
  });


  function timeAgo(dateString) {
    const now = new Date();
    const past = new Date(dateString);
    const diff = Math.floor((now - past) / 1000);

    if (diff < 60) return diff + " detik lalu"; if (diff < 3600) return Math.floor(diff / 60) + " menit lalu"; if (diff <
      86400) return Math.floor(diff / 3600) + " jam lalu"; if (diff < 2592000) return Math.floor(diff / 86400)
        + " hari lalu"; if (diff < 31536000) return Math.floor(diff / 2592000) + " bulan lalu"; return Math.floor(diff /
          31536000) + " tahun lalu";
  } document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".time-ago").forEach(el => {
      el.innerText = timeAgo(el.dataset.time);
    });
  });
</script>