<!-- Navbar -->
<nav class="main-header navbar navbar-expand-md navbar-light navbar-white">
  <div class="container">
    <a href="/user" class="navbar-brand">
      <span class="brand-text font-weight-light">Faceelook</span>
    </a>

    <div class="collapse navbar-collapse order-3">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="/logout">
            <i class="fas fa-sign-out-alt"></i> Logout
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="content-wrapper">
  <div class="content pt-4">
    <div class="container">

      <% if (!profile) { %>
        <div class="alert alert-warning text-center">
          Profil Anda belum dibuat.
          <br />
          <a href="/user/settings" class="btn btn-sm btn-primary mt-2">
            Lengkapi Profil Sekarang
          </a>
        </div>
        <% } %>

          <div class="row">

            <!-- LEFT SIDE -->
            <div class="col-md-3">

              <!-- Profile Card -->
              <div class="card card-primary card-outline">
                <div class="card-body box-profile">

                  <div class="text-center">
                    <img class="profile-user-img img-fluid img-circle"
                      src="<%= profile?.photo_url || 'https://cdn-icons-png.flaticon.com/512/149/149071.png' %>"
                      alt="User profile picture" />
                  </div>

                  <h3 class="profile-username text-center">
                    <%= profile?.full_name || 'Nama belum diatur' %>
                  </h3>

                  <p class="text-muted text-center">
                    <%= profile?.bio || 'Belum menambahkan bio' %>
                  </p>

                  <button class="btn btn-primary btn-block" data-toggle="modal" data-target="#editProfileModal">
                    <b>Edit Profile</b>
                  </button>

                </div>
              </div>

              <!-- About Me -->
              <div class="card card-primary">
                <div class="card-header">
                  <h3 class="card-title">About Me</h3>
                </div>

                <div class="card-body">

                  <strong>
                    <i class="fas fa-book mr-1"></i> Education
                  </strong>
                  <p class="text-muted">
                    <%= profile?.education || 'Belum mengisi riwayat pendidikan' %>
                  </p>

                  <hr />

                  <strong>
                    <i class="fas fa-map-marker-alt mr-1"></i> Location
                  </strong>
                  <p class="text-muted">
                    <%= profile?.address || 'Lokasi belum diatur' %>
                  </p>

                  <hr />

                  <strong>
                    <i class="fas fa-pencil-alt mr-1"></i> Skills
                  </strong>
                  <p class="text-muted">
                    <%= profile?.skills || 'Belum menambahkan keahlian' %>
                  </p>

                  <hr />

                  <strong>
                    <i class="fas fa-venus-mars mr-1"></i> Gender
                  </strong>
                  <p class="text-muted">
                    <%= profile?.gender || 'Belum diisi' %>
                  </p>

                  <hr />

                  <strong>
                    <i class="fas fa-birthday-cake mr-1"></i> Date of Birth
                  </strong>
                  <p class="text-muted">
                    <%= profile?.date_of_birth || 'Belum diisi' %>
                  </p>

                </div>
              </div>
            </div>

            <!-- RIGHT SIDE -->
            <div class="col-md-9">
              <div class="card">
                <div class="card-header p-2">
                  <ul class="nav nav-pills">
                    <li class="nav-item">
                      <a class="nav-link active" href="#activity" data-toggle="tab">
                        Feed / Aktivitas
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="#posts" data-toggle="tab">
                        Postingan
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="#settings" data-toggle="tab">
                        Settings
                      </a>
                    </li>
                  </ul>
                </div>

                <div class="card-body">
                  <div class="tab-content">

                    <!-- Activity -->
                    <div class="active tab-pane" id="activity">
                      <div class="alert alert-info">
                        Belum ada aktivitas terbaru.
                      </div>
                    </div>

                    <!-- Post -->
                    <div class="tab-pane" id="posts">
                      <div class="card card-outline card-secondary">
                        <div class="card-body">

                          <div class="d-flex align-items-center mb-3">

                            <!-- Avatar -->
                            <img
                              src="<%= profile?.photo_url || 'https://cdn-icons-png.flaticon.com/512/149/149071.png' %>"
                              class="img-circle" width="40" height="40" />

                            <!-- Input -->
                            <input type="text" class="form-control ml-2"
                              placeholder="Apa yang Anda pikirkan hari ini?" />

                            <!-- Add Button -->
                            <button class="btn btn-primary ml-2" type="button">
                              <i class="fas fa-plus"></i>
                            </button>

                          </div>

                          <div class="text-muted text-center">
                            Belum ada postingan.
                          </div>

                        </div>
                      </div>
                    </div>

                    <!-- Settings -->
                    <div class="tab-pane" id="settings">
                      <div class="text-center">
                        <p>Kelola akun dan informasi pribadi Anda.</p>
                        <a href="/user/settings" class="btn btn-primary">
                          Buka Pengaturan
                        </a>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>

          </div>
    </div>
  </div>
</div>

<!-- Footer -->
<footer class="main-footer">
  <div class="container">
    <div class="float-right d-none d-sm-block">
      <b>Version</b> 1.0.0
    </div>
    <strong>
      &copy; <%= new Date().getFullYear() %> from Faceelook
    </strong>
    All rights reserved.
  </div>
</footer>


<!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Edit Profile</h5>
        <button type="button" class="close" data-dismiss="modal">
          <span>&times;</span>
        </button>
      </div>

      <form method="POST" action="/web-user/update/profile" enctype="multipart/form-data">

        <div class="modal-body" style="max-height:70vh; overflow-y:auto;">

          <!-- PROFILE PHOTO -->
          <div class="text-center mb-4">
            <div class="position-relative d-inline-block">

              <img id="profilePreview"
                src="<%= profile?.photo_url || 'https://cdn-icons-png.flaticon.com/512/149/149071.png' %>"
                class="rounded-circle shadow" width="120" height="120" style="object-fit:cover;" />

              <label class="btn btn-sm btn-primary position-absolute"
                style="bottom:0; right:0; border-radius:50%; padding:6px 8px;">
                üñãÔ∏è
                <input type="file" name="photo" id="photoInput" hidden accept="image/*" />
              </label>

            </div>
            <div class="mt-2 text-muted small">
              Klik icon untuk ganti foto
            </div>
          </div>

          <div class="row">

            <!-- Full Name -->
            <div class="col-md-6">
              <div class="form-group">
                <label>Full Name</label>
                <input type="text" name="full_name" class="form-control" value="<%= profile?.full_name || '' %>"
                  placeholder="Masukkan nama lengkap" />
              </div>
            </div>

            <!-- Gender -->
            <div class="col-md-6">
              <div class="form-group">
                <label>Gender</label>
                <select name="gender" class="form-control">
                  <option value="">Pilih Gender</option>
                  <option value="MALE" <%=profile?.gender==='MALE' ? 'selected' : '' %>>Male</option>
                  <option value="FEMALE" <%=profile?.gender==='FEMALE' ? 'selected' : '' %>>Female</option>
                </select>
              </div>
            </div>

            <!-- Bio -->
            <div class="col-12">
              <div class="form-group">
                <label>Bio</label>
                <textarea name="bio" class="form-control" rows="2"
                  placeholder="Ceritakan tentang diri Anda"><%= profile?.bio || '' %></textarea>
              </div>
            </div>

            <!-- Education -->
            <div class="col-md-6">
              <div class="form-group">
                <label>Education</label>
                <input type="text" name="education" class="form-control" value="<%= profile?.education || '' %>"
                  placeholder="Contoh: S1 Informatika" />
              </div>
            </div>

            <!-- Date of Birth -->
            <div class="col-md-6">
              <div class="form-group">
                <label>Date of Birth</label>
                <input type="date" name="date_of_birth" class="form-control"
                  value="<%= profile?.date_of_birth || '' %>" />
              </div>
            </div>

            <!-- Address -->
            <div class="col-12">
              <div class="form-group">
                <label>Address</label>
                <input type="text" name="address" class="form-control" value="<%= profile?.address || '' %>"
                  placeholder="Masukkan alamat" />
              </div>
            </div>

            <!-- Skills -->
            <div class="col-12">
              <div class="form-group">
                <label>Skills</label>
                <input type="text" name="skills" class="form-control" value="<%= profile?.skills || '' %>"
                  placeholder="Pisahkan dengan koma" />
              </div>
            </div>

          </div>
        </div>

        <!-- FOOTER FIXED -->
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">
            Cancel
          </button>

          <button type="submit" class="btn btn-primary">
            Save Changes
          </button>
        </div>

      </form>

    </div>
  </div>
</div>

<script>
  // Preview Photo
  document.getElementById('photoInput').addEventListener('change', function (e) {
    const file = e.target.files[0];
    if (file) {
      document.getElementById('profilePreview').src = URL.createObjectURL(file);
    }
  });

</script>